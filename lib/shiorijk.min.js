var ShioriJK,extend=function(e,t){function r(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;ShioriJK={},"undefined"!=typeof module&&null!==module&&null!=module.exports&&(module.exports=ShioriJK),Function.prototype.property=function(e){var t,r,i;i=[];for(r in e)t=e[r],i.push(Object.defineProperty(this.prototype,r,t));return i},ShioriJK.Message={},ShioriJK.Message.Request=function(){function e(e){null!=e&&e.no_prepare||(this.request_line=new ShioriJK.RequestLine,this.headers=new ShioriJK.Headers.Request)}return e.prototype.request_line=null,e.prototype.headers=null,e.prototype.toString=function(){return this.request_line.toString()+"\r\n"+this.headers.toString()+"\r\n"},e}(),ShioriJK.Message.Response=function(){function e(e){null!=e&&e.no_prepare||(this.status_line=new ShioriJK.StatusLine,this.headers=new ShioriJK.Headers.Response)}return e.prototype.status_line=null,e.prototype.headers=null,e.prototype.toString=function(){return this.status_line.toString()+"\r\n"+this.headers.toString()+"\r\n"},e}(),ShioriJK.RequestLine=function(){function e(){this.arguments={}}return e.prototype.method=null,e.prototype.protocol=null,e.prototype.version=null,e.property({method:{get:function(){return this.arguments.method},set:function(e){if(null!=e&&null!=this.version)this.validate_method_version(e,this.version);else if(null!=e)switch(e){case"GET":case"NOTIFY":case"GET Version":case"GET Sentence":case"GET Word":case"GET Status":case"TEACH":case"GET String":case"NOTIFY OwnerGhostName":case"NOTIFY OtherGhostName":case"TRANSLATE Sentence":break;default:throw"Invalid protocol method : "+e}return this.arguments.method=e}},protocol:{get:function(){return this.arguments.protocol},set:function(e){if(null!=e&&"SHIORI"!==e)throw"Invalid protocol : "+e;return this.arguments.protocol=e}},version:{get:function(){return this.arguments.version},set:function(e){if(null!=this.method&&null!=e)this.validate_method_version(this.method,e);else if(null!=e)switch(e){case"2.0":case"2.2":case"2.3":case"2.4":case"2.5":case"2.6":case"3.0":break;default:throw"Invalid protocol version : "+e}return this.arguments.version=e}}}),e.prototype.validate_method_version=function(e,t){var r;switch(r=!1,t){case"2.0":switch(e){case"GET Version":case"NOTIFY OwnerGhostName":case"GET Sentence":case"GET Word":case"GET Status":r=!0}break;case"2.2":switch(e){case"GET Sentence":r=!0}break;case"2.3":switch(e){case"NOTIFY OtherGhostName":case"GET Sentence":r=!0}break;case"2.4":switch(e){case"TEACH":r=!0}break;case"2.5":switch(e){case"GET String":r=!0}break;case"2.6":switch(e){case"GET Sentence":case"GET Status":case"GET String":case"NOTIFY OwnerGhostName":case"NOTIFY OtherGhostName":case"GET Version":case"TRANSLATE Sentence":r=!0}break;case"3.0":switch(e){case"GET":case"NOTIFY":r=!0}}if(!r)throw"Invalid protocol method and version : "+e+" SHIORI/"+t},e.prototype.toString=function(){return this.method+" "+this.protocol+"/"+this.version},e}(),ShioriJK.StatusLine=function(){function e(){this.arguments={protocol:"SHIORI"}}return e.prototype.code=null,e.prototype.protocol=null,e.prototype.version=null,e.property({code:{get:function(){return this.arguments.code},set:function(e){if(null!=e&&null==this.message[e])throw"Invalid response code : "+e;return this.arguments.code=e}},protocol:{get:function(){return this.arguments.protocol},set:function(e){if(null!=e&&"SHIORI"!==e)throw"Invalid protocol : "+e;return this.arguments.protocol=e}},version:{get:function(){return this.arguments.version},set:function(e){if(null!=e)switch(e){case"2.0":case"2.2":case"2.3":case"2.4":case"2.5":case"2.6":case"3.0":break;default:throw"Invalid protocol version : "+e}return this.arguments.version=e}}}),e.prototype.toString=function(){return this.protocol+"/"+this.version+" "+this.code+" "+this.message[this.code]},e.prototype.message={200:"OK",204:"No Content",310:"Communicate",311:"Not Enough",312:"Advice",400:"Bad Request",418:"I'm a tea pot",500:"Internal Server Error"},e}(),ShioriJK.Headers=function(){function e(){this.header={}}return e.prototype.header=null,e.prototype.get=function(e){return null!=this.header[e]?this.header[e]:void 0},e.prototype.set=function(e,t){return this.header[e]=t},e.prototype.get_separated=function(e,t){return null==t&&(t=""),null!=this.header[e]?this.header[e].split(t):void 0},e.prototype.set_separated=function(e,t,r){return null==r&&(r=""),this.header[e]=t.join(r)},e.prototype.get_separated2=function(e,t,r){var i,n,o,s,u;if(null==t&&(t=""),null==r&&(r=""),null!=this.header[e]){for(s=this.header[e].split(t),u=[],n=0,o=s.length;o>n;n++)i=s[n],u.push(i.split(r));return u}},e.prototype.set_separated2=function(e,t,r,i){var n;return null==r&&(r=""),null==i&&(i=""),this.header[e]=function(){var e,r,o;for(o=[],e=0,r=t.length;r>e;e++)n=t[e],o.push(n.join(i));return o}().join(r)},e.prototype.validate=function(){var e,t,r,i;t=this.header,r=[];for(e in t){if(i=t[e],i.match(/\n/))throw"Invalid header value - line feed found : ["+e+"] : "+i;r.push(void 0)}return r},e.prototype.toString=function(){var e,t,r,i;r="",this.validate(),t=this.header;for(e in t)i=t[e],r+=e+": "+i+"\r\n";return r},e}(),ShioriJK.Headers.Request=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(ShioriJK.Headers),ShioriJK.Headers.Response=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(ShioriJK.Headers),ShioriJK.Shiori={},ShioriJK.Shiori.Header={},ShioriJK.Shiori.Request={},ShioriJK.Shiori.Request.RequestLine={},ShioriJK.Shiori.Request.Header={},ShioriJK.Shiori.Response={},ShioriJK.Shiori.Response.StatusLine={},ShioriJK.Shiori.Response.Header={},ShioriJK.Shiori.Parser=function(){function e(){}return e.prototype.is_parsing=function(){return!this.section.is("idle")},e.prototype.is_parsing_end=function(){return!this.section.is("end")},e.prototype.get_result=function(){return this.result},e.prototype.result_builder=function(){},e.prototype.begin_parse=function(){if(!this.section.is("idle"))throw"cannot begin parsing because previous transaction is still working";return this.result=this.result_builder(),this.section.next()},e.prototype.end_parse=function(){if(!this.section.is("end"))throw this.abort_parse(),"parsing was aborted";return this.section.next()},e.prototype.abort_parse=function(){var e,t,r;if(null!=this.parsers){r=this.parsers;for(e in r)t=r[e],null!=t.abort_parse&&t.abort_parse()}return this.section.set("idle")},e.prototype.parse=function(e){var t;if(this.begin_parse(),t=this.parse_chunk(e),this.is_parsing())throw"transaction is not closed";if(1!==t.results.length)throw"multiple transaction";return t.results[0]},e.prototype.parse_chunk=function(e){var t;return t=e.split(/\r\n/),e.match(/\r\n$/)&&t.pop(),this.parse_lines(t)},e.prototype.parse_lines=function(e){var t,r,i,n,o;for(o=[],t=0,r=e.length;r>t;t++)i=e[t],n=this.parse_line(i),"end"===n.state&&o.push(n.result);return{results:o,state:n.state}},e.prototype.parse_line=function(e){return this.section.is("idle")&&this.begin_parse(),this.parse_main(e),this.section.is("end")?(this.end_parse(),{result:this.get_result(),state:"end"}):{state:"continue"}},e.prototype.parse_main=function(e){},e}(),ShioriJK.Shiori.Section=function(){function e(e){this.sections=e,this.index=0}return e.prototype.is=function(e){return this.sections[this.index]===e},e.prototype.next=function(){return this.index===this.sections.length-1?this.index=0:this.index++},e.prototype.previous=function(){return 0===this.index?this.index=this.sections.length-1:this.index--},e.prototype.set=function(e){return this.index=this.sections.indexOf(e)},e.prototype.get=function(){return this.sections[this.index]},e}(),ShioriJK.Shiori.Header.Parser=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.parse_main=function(e){var t;return t=this.parse_header(e),"end"===t.state?this.section.next():void 0},t.prototype.parse_header=function(e){var t;if(e.length){if(!(t=e.match(/^(.+?): (.*)$/)))throw"Invalid header line : "+e;return this.result.header[t[1]]=t[2],{state:"continue"}}return{state:"end"}},t}(ShioriJK.Shiori.Parser),ShioriJK.Shiori.Header.Section=function(e){function t(e){this.sections=null!=e?e:["idle","header","end"],this.index=0}return extend(t,e),t}(ShioriJK.Shiori.Section),ShioriJK.Shiori.Request.Parser=function(e){function t(){this.parsers={request_line:new ShioriJK.Shiori.Request.RequestLine.Parser,headers:new ShioriJK.Shiori.Request.Header.Parser},this.section=new ShioriJK.Shiori.Request.Section}return extend(t,e),t.prototype.result_builder=function(){return new ShioriJK.Message.Request({no_prepare:!0})},t.prototype.parse_main=function(e){var t,r;return t=this.parsers[this.section.get()],r=t.parse_line(e),"end"===r.state?(this.result[this.section.get()]=r.result,this.section.next()):void 0},t}(ShioriJK.Shiori.Parser),ShioriJK.Shiori.Request.RequestLine.Parser=function(){function e(){}return e.prototype.result_builder=function(){return new ShioriJK.RequestLine},e.prototype.parse=function(e){return this.parse_chunk(e)},e.prototype.parse_chunk=function(e){return this.parse_line(e)},e.prototype.parse_line=function(e){var t;if(t=e.match(/^([A-Za-z0-9 ]+) SHIORI\/([0-9.]+)/),!t)throw"Invalid request line : "+e;return this.result=this.result_builder(),this.result.method=t[1],this.result.protocol="SHIORI",this.result.version=t[2],{result:this.result,state:"end"}},e}(),ShioriJK.Shiori.Request.Header.Parser=function(e){function t(){this.section=new ShioriJK.Shiori.Request.Header.Section}return extend(t,e),t.prototype.result_builder=function(){return new ShioriJK.Headers.Request},t}(ShioriJK.Shiori.Header.Parser),ShioriJK.Shiori.Request.Section=function(e){function t(e){this.sections=null!=e?e:["idle","request_line","headers","end"],this.index=0}return extend(t,e),t}(ShioriJK.Shiori.Section),ShioriJK.Shiori.Request.Header.Section=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(ShioriJK.Shiori.Header.Section),ShioriJK.Shiori.Response.Parser=function(e){function t(){this.parsers={status_line:new ShioriJK.Shiori.Response.StatusLine.Parser,headers:new ShioriJK.Shiori.Response.Header.Parser},this.section=new ShioriJK.Shiori.Response.Section}return extend(t,e),t.prototype.result_builder=function(){return new ShioriJK.Message.Response({no_prepare:!0})},t.prototype.parse_main=function(e){var t,r;return t=this.parsers[this.section.get()],r=t.parse_line(e),"end"===r.state?(this.result[this.section.get()]=r.result,this.section.next()):void 0},t}(ShioriJK.Shiori.Parser),ShioriJK.Shiori.Response.StatusLine.Parser=function(){function e(){}return e.prototype.result_builder=function(){return new ShioriJK.StatusLine},e.prototype.parse=function(e){return this.parse_chunk(e)},e.prototype.parse_chunk=function(e){return this.parse_line(e)},e.prototype.parse_line=function(e){var t;if(t=e.match(/^SHIORI\/([0-9.]+) (\d+) (.+)$/),!t)throw"Invalid status line : "+e;return this.result=this.result_builder(),this.result.protocol="SHIORI",this.result.version=t[1],this.result.code=t[2]-0,{result:this.result,state:"end"}},e}(),ShioriJK.Shiori.Response.Header.Parser=function(e){function t(){this.section=new ShioriJK.Shiori.Response.Header.Section}return extend(t,e),t.prototype.result_builder=function(){return new ShioriJK.Headers.Response},t}(ShioriJK.Shiori.Header.Parser),ShioriJK.Shiori.Response.Section=function(e){function t(e){this.sections=null!=e?e:["idle","status_line","headers","end"],this.index=0}return extend(t,e),t}(ShioriJK.Shiori.Section),ShioriJK.Shiori.Response.Header.Section=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(ShioriJK.Shiori.Header.Section);
//# sourceMappingURL=shiorijk.min.js.map
